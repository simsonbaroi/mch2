<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>MCH Billing System | Enterprise Hospital Billing</title>
  <meta name="description" content="Comprehensive hospital billing and price list management system with advanced medicine dosage calculations." />
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            background: 'hsl(var(--background))',
            foreground: 'hsl(var(--foreground))',
            card: 'hsl(var(--card))',
            'card-foreground': 'hsl(var(--card-foreground))',
            primary: 'hsl(var(--primary))',
            'primary-foreground': 'hsl(var(--primary-foreground))',
            secondary: 'hsl(var(--secondary))',
            'secondary-foreground': 'hsl(var(--secondary-foreground))',
            muted: 'hsl(var(--muted))',
            'muted-foreground': 'hsl(var(--muted-foreground))',
            accent: 'hsl(var(--accent))',
            'accent-foreground': 'hsl(var(--accent-foreground))',
            destructive: 'hsl(var(--destructive))',
            'destructive-foreground': 'hsl(var(--destructive-foreground))',
            border: 'hsl(var(--border))',
            input: 'hsl(var(--input))',
            ring: 'hsl(var(--ring))',
            'surface-light': 'hsl(var(--surface-light))',
            'accent-blue': 'hsl(var(--accent-blue))',
            'accent-red': 'hsl(var(--accent-red))',
          },
          fontFamily: {
            sans: ['Plus Jakarta Sans', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
          },
          animation: {
            'fade-in': 'fadeIn 0.3s ease-out',
            'scale-in': 'scaleIn 0.2s ease-out',
            'slide-in-right': 'slideInRight 0.3s ease-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            scaleIn: {
              '0%': { opacity: '0', transform: 'scale(0.95)' },
              '100%': { opacity: '1', transform: 'scale(1)' },
            },
            slideInRight: {
              '0%': { opacity: '0', transform: 'translateX(100%)' },
              '100%': { opacity: '1', transform: 'translateX(0)' },
            },
          },
        },
      },
    }
  </script>
  
  <style>
    :root {
      --background: 240 10% 4%;
      --foreground: 0 0% 100%;
      --card: 240 6% 7%;
      --card-foreground: 0 0% 100%;
      --popover: 240 6% 7%;
      --popover-foreground: 0 0% 100%;
      --primary: 160 84% 39%;
      --primary-foreground: 0 0% 100%;
      --secondary: 240 5% 12%;
      --secondary-foreground: 0 0% 100%;
      --muted: 240 5% 12%;
      --muted-foreground: 240 5% 65%;
      --accent: 199 89% 48%;
      --accent-foreground: 0 0% 100%;
      --destructive: 0 62% 31%;
      --destructive-foreground: 0 0% 100%;
      --border: 240 4% 16%;
      --input: 0 0% 0%;
      --ring: 160 84% 39%;
      --primary-soft: 160 84% 39% / 0.1;
      --primary-glow: 160 84% 39% / 0.3;
      --surface: 240 6% 7%;
      --surface-light: 240 5% 11%;
      --nav-bg: 240 6% 5%;
      --accent-blue: 199 89% 48%;
      --accent-red: 0 84% 60%;
    }

    :root.light {
      --background: 0 0% 97%;
      --foreground: 220 20% 15%;
      --card: 0 0% 100%;
      --card-foreground: 220 20% 15%;
      --primary: 160 70% 36%;
      --primary-foreground: 0 0% 100%;
      --secondary: 220 10% 92%;
      --secondary-foreground: 220 20% 20%;
      --muted: 220 10% 92%;
      --muted-foreground: 220 10% 40%;
      --accent: 199 80% 45%;
      --accent-foreground: 0 0% 100%;
      --destructive: 0 72% 51%;
      --destructive-foreground: 0 0% 100%;
      --border: 220 10% 82%;
      --input: 0 0% 100%;
      --ring: 160 70% 36%;
      --surface-light: 220 10% 96%;
      --accent-blue: 199 80% 45%;
      --accent-red: 0 72% 51%;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; border-color: hsl(var(--border)); }
    body {
      background: hsl(var(--background));
      color: hsl(var(--foreground));
      font-family: 'Plus Jakarta Sans', sans-serif;
      -webkit-font-smoothing: antialiased;
    }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: hsl(var(--background)); }
    ::-webkit-scrollbar-thumb { background: hsl(var(--border)); border-radius: 10px; }
    .shadow-primary-glow { box-shadow: 0 0 30px hsl(var(--primary-glow)); }
    .touch-feedback { transition: all 0.1s; }
    .touch-feedback:active { transform: scale(0.97); opacity: 0.8; }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React & ReactDOM from esm.sh -->
  <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.3.1",
        "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
        "react-router-dom": "https://esm.sh/react-router-dom@6.30.1",
        "lucide-react": "https://esm.sh/lucide-react@0.462.0"
      }
    }
  </script>

  <script type="module">
    import React, { useState, useEffect, useCallback, createContext, useContext, useRef } from 'react';
    import { createRoot } from 'react-dom/client';
    import { HashRouter, Routes, Route, useNavigate, useLocation } from 'react-router-dom';
    import * as LucideIcons from 'lucide-react';

    const { 
      Home, UserCheck, BedDouble, Tags, Users, Microscope, Settings, Sun, Moon, 
      LogOut, User, Menu, X, Search, ChevronLeft, ChevronRight, CheckCircle2,
      FlaskConical, PlusCircle, Pill, UserCircle, ShieldCheck
    } = LucideIcons;

    // ============= MOCK DATA =============
    const INPATIENT_CATEGORIES = [
      "Medicine", "Laboratory", "Blood", "Surgery, O.R. & Delivery",
      "Registration Fees", "Physical Therapy", "Limb and Brace", "Food",
      "Halo, O2, NO2, etc.", "Orthopedic, S.Roll, etc.", "IV.'s",
      "Discharge Medicine", "Procedures", "Seat & Ad. Fee"
    ];

    const MOCK_INVENTORY = {
      "Medicine": [
        { id: 1, name: "Paracetamol 500mg", price: 5.00, type: "Tablet", strength: "500mg", category: "Medicine" },
        { id: 2, name: "Amoxicillin 500mg", price: 12.50, type: "Capsule", strength: "500mg", category: "Medicine" },
        { id: 3, name: "Omeprazole 20mg", price: 8.00, type: "Capsule", strength: "20mg", category: "Medicine" },
        { id: 4, name: "Metformin 500mg", price: 6.50, type: "Tablet", strength: "500mg", category: "Medicine" },
        { id: 5, name: "Losartan 50mg", price: 15.00, type: "Tablet", strength: "50mg", category: "Medicine" },
      ],
      "Laboratory": [
        { id: 101, name: "Complete Blood Count", price: 350.00, type: "Test", category: "Laboratory" },
        { id: 102, name: "Urinalysis", price: 150.00, type: "Test", category: "Laboratory" },
        { id: 103, name: "Blood Chemistry", price: 800.00, type: "Test", category: "Laboratory" },
        { id: 104, name: "Lipid Profile", price: 600.00, type: "Test", category: "Laboratory" },
        { id: 105, name: "Thyroid Function Test", price: 1200.00, type: "Test", category: "Laboratory" },
      ],
      "Blood": [
        { id: 201, name: "Whole Blood (450ml)", price: 1500.00, type: "Unit", category: "Blood" },
        { id: 202, name: "Packed RBC", price: 1800.00, type: "Unit", category: "Blood" },
        { id: 203, name: "Fresh Frozen Plasma", price: 1200.00, type: "Unit", category: "Blood" },
      ],
      "Registration Fees": [
        { id: 301, name: "OPD Registration", price: 100.00, type: "Service", category: "Registration Fees" },
        { id: 302, name: "Emergency Registration", price: 250.00, type: "Service", category: "Registration Fees" },
        { id: 303, name: "Admission Fee", price: 500.00, type: "Service", category: "Registration Fees" },
      ],
      "Procedures": [
        { id: 401, name: "Wound Dressing", price: 200.00, type: "Service", category: "Procedures" },
        { id: 402, name: "IV Insertion", price: 150.00, type: "Service", category: "Procedures" },
        { id: 403, name: "ECG", price: 300.00, type: "Service", category: "Procedures" },
        { id: 404, name: "Nebulization", price: 100.00, type: "Service", category: "Procedures" },
      ],
      "Discharge Medicine": [
        { id: 501, name: "Discharge Med Kit A", price: 250.00, type: "Kit", category: "Discharge Medicine" },
        { id: 502, name: "Discharge Med Kit B", price: 450.00, type: "Kit", category: "Discharge Medicine" },
      ],
    };

    const MOCK_PATIENTS = [
      { id: 1, name: "John Doe", age: 45, phone: "01712345678" },
      { id: 2, name: "Jane Smith", age: 32, phone: "01898765432" },
      { id: 3, name: "Robert Johnson", age: 58, phone: "01555555555" },
    ];

    // ============= AUTH CONTEXT (MOCK) =============
    const AuthContext = createContext(null);

    const AuthProvider = ({ children }) => {
      const auth = {
        user: { id: '1', email: 'admin@mch.local', fullName: 'Dr. Preview' },
        session: { user: { id: '1', email: 'admin@mch.local', fullName: 'Dr. Preview' } },
        role: 'admin',
        isLoading: false,
        signIn: async () => ({ error: null }),
        signUp: async () => ({ error: null }),
        signOut: async () => ({ error: null }),
        hasRole: (role) => role === 'admin',
        canEdit: () => true,
        isAdmin: () => true,
      };
      return React.createElement(AuthContext.Provider, { value: auth }, children);
    };

    const useAuth = () => {
      const context = useContext(AuthContext);
      if (!context) throw new Error('useAuth must be used within AuthProvider');
      return context;
    };

    // ============= SETTINGS CONTEXT =============
    const SettingsContext = createContext(null);

    const SettingsProvider = ({ children }) => {
      const [isDarkMode, setIsDarkMode] = useState(true);
      
      const settings = {
        appName: 'MCH',
        appSubtitle: 'Billing System',
        logoUrl: '',
        isDarkMode,
        navButtons: [
          { id: 'home', label: 'HOME', icon: 'Home', visible: true },
          { id: 'outpatient', label: 'OUTPATIENT', icon: 'UserCheck', visible: true },
          { id: 'inpatient', label: 'INPATIENT', icon: 'BedDouble', visible: true },
          { id: 'pricing', label: 'PRICING', icon: 'Tags', visible: true },
          { id: 'patients', label: 'PATIENTS', icon: 'Users', visible: true },
        ],
      };

      const updateSettings = (updates) => {
        if ('isDarkMode' in updates) {
          setIsDarkMode(updates.isDarkMode);
          document.documentElement.classList.toggle('dark', updates.isDarkMode);
          document.documentElement.classList.toggle('light', !updates.isDarkMode);
        }
      };

      return React.createElement(SettingsContext.Provider, { value: { settings, updateSettings } }, children);
    };

    const useSettings = () => {
      const context = useContext(SettingsContext);
      if (!context) throw new Error('useSettings must be used within SettingsProvider');
      return context;
    };

    // ============= BILLING CONTEXT =============
    const BillingContext = createContext(null);

    const BillingProvider = ({ children }) => {
      const [bill, setBill] = useState([]);
      const [currentView, setCurrentView] = useState('home');
      const [currentCatOPIdx, setCurrentCatOPIdx] = useState(0);
      const [currentCatIPIdx, setCurrentCatIPIdx] = useState(0);

      const inventory = MOCK_INVENTORY;
      const outpatientCategories = Object.keys(inventory).sort();
      const inpatientCategories = INPATIENT_CATEGORIES;

      const addToBill = useCallback((item) => {
        setBill(prev => [...prev, item]);
      }, []);

      const removeFromBill = useCallback((index) => {
        setBill(prev => prev.filter((_, i) => i !== index));
      }, []);

      const clearBill = useCallback(() => {
        setBill([]);
      }, []);

      const value = {
        inventory, bill, addToBill, removeFromBill, clearBill,
        currentView, setCurrentView,
        outpatientCategories, inpatientCategories,
        currentCatOPIdx, setCurrentCatOPIdx,
        currentCatIPIdx, setCurrentCatIPIdx,
        isLoading: false, isSyncing: false,
      };

      return React.createElement(BillingContext.Provider, { value }, children);
    };

    const useBilling = () => {
      const context = useContext(BillingContext);
      if (!context) throw new Error('useBilling must be used within BillingProvider');
      return context;
    };

    // ============= HOOKS =============
    const useClock = () => {
      const [time, setTime] = useState(new Date().toLocaleTimeString('en-GB'));
      useEffect(() => {
        const interval = setInterval(() => {
          setTime(new Date().toLocaleTimeString('en-GB'));
        }, 1000);
        return () => clearInterval(interval);
      }, []);
      return time;
    };

    // ============= UTILITY =============
    const cn = (...classes) => classes.filter(Boolean).join(' ');

    const validateQuantity = (value) => {
      const num = parseFloat(value);
      if (isNaN(num) || num <= 0) return { valid: false, error: 'Invalid quantity' };
      return { valid: true, value: num };
    };

    const validateDays = (value) => {
      const num = parseInt(value);
      if (isNaN(num) || num < 1 || num > 365) return { valid: false, error: 'Days must be 1-365' };
      return { valid: true, value: num };
    };

    const validateServiceQty = (value) => {
      const num = parseFloat(value);
      if (isNaN(num) || num < 1) return { valid: false, error: 'Quantity must be at least 1' };
      return { valid: true, value: num };
    };

    // ============= COMPONENTS =============

    // Toast (simple implementation)
    let toastContainer = null;
    const toast = {
      success: (msg) => showToast(msg, 'success'),
      error: (msg) => showToast(msg, 'error'),
    };

    const showToast = (message, type) => {
      if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.style.cssText = 'position:fixed;bottom:20px;right:20px;z-index:9999;';
        document.body.appendChild(toastContainer);
      }
      const toast = document.createElement('div');
      toast.style.cssText = `padding:12px 20px;margin-top:8px;border-radius:8px;font-weight:600;font-size:14px;background:${type === 'success' ? 'hsl(160,84%,39%)' : 'hsl(0,62%,31%)'};color:white;`;
      toast.textContent = message;
      toastContainer.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    };

    // Header Component
    const Header = () => {
      const time = useClock();
      const { settings, updateSettings } = useSettings();
      const { user, role, signOut } = useAuth();
      const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
      const navigate = useNavigate();

      const handleSignOut = async () => {
        await signOut();
        navigate('/auth');
      };

      const getRoleBadgeColor = () => {
        switch (role) {
          case 'admin': return 'bg-red-500/20 text-red-400 border-red-500/30';
          case 'billing_clerk': return 'bg-primary/20 text-primary border-primary/30';
          default: return 'bg-muted text-muted-foreground border-border';
        }
      };

      return React.createElement('header', { className: 'bg-background border-b border-border sticky top-0 z-50' },
        React.createElement('div', { className: 'max-w-7xl mx-auto px-3 sm:px-4 py-3 sm:py-4 flex justify-between items-center' },
          // Logo and Title
          React.createElement('div', { className: 'flex items-center gap-2 sm:gap-3 cursor-pointer flex-shrink-0', onClick: () => window.location.reload() },
            React.createElement(Microscope, { className: 'w-7 h-7 sm:w-8 sm:h-8 text-primary drop-shadow-lg' }),
            React.createElement('h1', { className: 'text-base sm:text-xl font-bold' },
              settings.appName,
              React.createElement('span', { className: 'hidden sm:inline font-light text-muted-foreground ml-2' }, settings.appSubtitle)
            )
          ),
          // Desktop Controls
          React.createElement('div', { className: 'hidden md:flex items-center gap-3' },
            React.createElement('button', {
              onClick: () => updateSettings({ isDarkMode: !settings.isDarkMode }),
              className: 'bg-surface-light border border-border w-10 h-10 rounded-lg flex items-center justify-center text-muted-foreground hover:border-primary hover:text-primary transition-all cursor-pointer',
              title: settings.isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'
            }, settings.isDarkMode ? React.createElement(Sun, { className: 'w-5 h-5' }) : React.createElement(Moon, { className: 'w-5 h-5' })),
            React.createElement('button', {
              onClick: handleSignOut,
              className: 'bg-surface-light border border-border w-10 h-10 rounded-lg flex items-center justify-center text-muted-foreground hover:border-destructive hover:text-destructive transition-all cursor-pointer',
              title: 'Sign Out'
            }, React.createElement(LogOut, { className: 'w-5 h-5' })),
            React.createElement('div', { className: 'text-primary font-mono font-bold text-lg' }, time)
          ),
          // Mobile Controls
          React.createElement('div', { className: 'flex md:hidden items-center gap-2' },
            React.createElement('button', {
              onClick: () => setIsMobileMenuOpen(!isMobileMenuOpen),
              className: 'bg-surface-light border border-border w-10 h-10 rounded-lg flex items-center justify-center text-muted-foreground touch-feedback'
            }, isMobileMenuOpen ? React.createElement(X, { className: 'w-5 h-5' }) : React.createElement(Menu, { className: 'w-5 h-5' }))
          )
        ),
        // Mobile Menu
        isMobileMenuOpen && React.createElement(React.Fragment, null,
          React.createElement('div', {
            className: 'md:hidden fixed inset-0 bg-background/80 backdrop-blur-sm z-40 animate-fade-in',
            onClick: () => setIsMobileMenuOpen(false)
          }),
          React.createElement('div', { className: 'md:hidden fixed top-0 right-0 bottom-0 w-[280px] bg-card border-l border-border p-4 animate-slide-in-right z-50 shadow-2xl' },
            React.createElement('button', {
              onClick: () => setIsMobileMenuOpen(false),
              className: 'absolute top-4 right-4 w-10 h-10 rounded-full bg-muted flex items-center justify-center text-muted-foreground touch-feedback'
            }, React.createElement(X, { className: 'w-5 h-5' })),
            React.createElement('div', { className: 'mt-12 space-y-6' },
              user && React.createElement('div', { className: 'bg-surface-light border border-border rounded-xl p-4' },
                React.createElement('div', { className: 'flex items-center gap-3 mb-3' },
                  React.createElement('div', { className: 'w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center' },
                    React.createElement(User, { className: 'w-6 h-6 text-primary' })
                  ),
                  React.createElement('div', { className: 'flex-1 min-w-0' },
                    React.createElement('p', { className: 'text-sm font-semibold text-foreground truncate' }, user.fullName || user.email),
                    React.createElement('p', { className: 'text-xs text-muted-foreground truncate' }, user.email)
                  )
                ),
                role && React.createElement('span', { className: `inline-block text-xs font-bold uppercase px-3 py-1.5 rounded-lg border ${getRoleBadgeColor()}` }, role.replace('_', ' '))
              ),
              React.createElement('div', { className: 'space-y-2' },
                React.createElement('button', {
                  onClick: () => { updateSettings({ isDarkMode: !settings.isDarkMode }); },
                  className: 'w-full bg-surface-light border border-border py-4 px-4 rounded-xl flex items-center gap-4 text-foreground touch-feedback'
                },
                  settings.isDarkMode ? React.createElement(Sun, { className: 'w-5 h-5 text-amber-500' }) : React.createElement(Moon, { className: 'w-5 h-5 text-indigo-500' }),
                  React.createElement('span', { className: 'font-medium' }, settings.isDarkMode ? 'Light Mode' : 'Dark Mode')
                ),
                React.createElement('button', {
                  onClick: () => { handleSignOut(); setIsMobileMenuOpen(false); },
                  className: 'w-full bg-destructive/10 border border-destructive/20 py-4 px-4 rounded-xl flex items-center gap-4 text-destructive touch-feedback'
                },
                  React.createElement(LogOut, { className: 'w-5 h-5' }),
                  React.createElement('span', { className: 'font-medium' }, 'Sign Out')
                )
              )
            )
          )
        )
      );
    };

    // Navigation Component
    const iconMap = { Home, UserCheck, BedDouble, Tags, Users };

    const Navigation = () => {
      const { currentView, setCurrentView } = useBilling();
      const { settings } = useSettings();
      const time = useClock();
      const visibleButtons = settings.navButtons.filter(btn => btn.visible);

      return React.createElement('div', { className: 'max-w-7xl mx-auto px-3 sm:px-4 mb-4 sm:mb-6' },
        React.createElement('nav', { className: 'flex bg-secondary/50 p-1.5 rounded-2xl border border-border gap-1.5' },
          visibleButtons.map((item) => {
            const IconComponent = iconMap[item.icon] || Home;
            return React.createElement('button', {
              key: item.id,
              onClick: () => setCurrentView(item.id),
              className: cn(
                'flex-1 py-3 px-4 rounded-xl border-none font-bold text-xs cursor-pointer flex flex-col md:flex-row items-center justify-center gap-2 transition-all duration-200 uppercase',
                currentView === item.id
                  ? 'bg-primary text-primary-foreground shadow-lg shadow-primary/30'
                  : 'bg-transparent text-muted-foreground hover:text-foreground hover:bg-surface-light'
              )
            },
              React.createElement(IconComponent, { className: 'w-5 h-5' }),
              React.createElement('span', { className: 'hidden md:inline' }, item.label)
            );
          })
        )
      );
    };

    // CategoryCard Component
    const CategoryCard = ({ name, count, isActive, onClick }) => {
      return React.createElement('div', {
        onClick,
        className: cn(
          'bg-card border border-border p-4 rounded-2xl cursor-pointer transition-all duration-200 shadow-md',
          'hover:transform hover:-translate-y-1 hover:border-primary hover:bg-surface-light hover:shadow-lg',
          isActive && 'bg-primary/10 border-primary border-b-[3px]'
        )
      },
        React.createElement('span', { className: 'block font-extrabold text-card-foreground text-sm tracking-tight' }, name),
        React.createElement('span', { className: 'block text-xs text-muted-foreground font-semibold mt-2 uppercase' }, `${count} ITEMS`)
      );
    };

    // CategoryCarousel Component
    const CategoryCarousel = ({ categoryName, itemCount, onPrev, onNext, onGridView }) => {
      return React.createElement('div', { className: 'bg-card border border-border rounded-2xl p-6 mb-6 shadow-md transition-shadow duration-300 animate-scale-in relative overflow-hidden' },
        React.createElement('div', { className: 'flex items-center justify-between gap-4' },
          React.createElement('button', {
            onClick: onPrev,
            className: 'w-11 h-11 rounded-xl border border-border bg-surface-light text-primary cursor-pointer transition-all duration-200 flex items-center justify-center hover:bg-primary hover:text-primary-foreground hover:border-primary hover:shadow-lg hover:shadow-primary/30'
          }, React.createElement(ChevronLeft, { className: 'w-5 h-5' })),
          React.createElement('div', { className: 'text-center flex-1' },
            React.createElement('h4', { className: 'font-black text-primary text-xl uppercase tracking-wider mb-1' }, categoryName),
            React.createElement('p', { className: 'text-muted-foreground font-bold text-xs' }, `${itemCount} indexed items`),
            React.createElement('button', {
              onClick: onGridView,
              className: 'mt-3 bg-primary text-primary-foreground font-extrabold rounded-xl px-4 py-1.5 text-xs uppercase tracking-wide transition-all duration-200 hover:bg-primary/90'
            }, 'GRID VIEW')
          ),
          React.createElement('button', {
            onClick: onNext,
            className: 'w-11 h-11 rounded-xl border border-border bg-surface-light text-primary cursor-pointer transition-all duration-200 flex items-center justify-center hover:bg-primary hover:text-primary-foreground hover:border-primary hover:shadow-lg hover:shadow-primary/30'
          }, React.createElement(ChevronRight, { className: 'w-5 h-5' }))
        )
      );
    };

    // ItemEntry Component
    const ItemEntry = ({ item, onClick }) => {
      return React.createElement('div', {
        onClick,
        className: 'bg-card border border-border rounded-2xl px-5 py-4 flex justify-between items-center transition-all duration-200 cursor-pointer shadow-md hover:border-primary hover:bg-surface-light hover:-translate-y-0.5 hover:shadow-lg animate-fade-in'
      },
        React.createElement('div', { className: 'flex flex-col gap-0.5' },
          React.createElement('span', { className: 'font-bold text-base text-foreground' }, item.name),
          React.createElement('span', { className: 'text-xs text-muted-foreground font-semibold uppercase tracking-wide' },
            `${item.type || 'Service'} ${item.strength ? `â€¢ ${item.strength}` : ''}`
          )
        ),
        React.createElement('div', { className: 'flex items-center gap-4' },
          React.createElement('span', { className: 'font-mono font-bold text-primary text-xl' },
            React.createElement('span', { className: 'text-base opacity-80 mr-1' }, 'à§³'),
            typeof item.price === 'number' ? item.price.toFixed(2) : item.price
          )
        )
      );
    };

    // DosagePanel Component
    const DosagePanel = ({ item, category, onClose, onAddToBill }) => {
      const [doseQty, setDoseQty] = useState('1.0');
      const [doseType, setDoseType] = useState('Tablet');
      const [doseFreq, setDoseFreq] = useState('3');
      const [doseDays, setDoseDays] = useState('7');
      const [serviceQty, setServiceQty] = useState('1');
      const [errors, setErrors] = useState({});

      const isMedicine = category === 'Medicine' || category === 'Discharge Medicine' ||
        ['Injection', 'Tablet', 'Capsule', 'Syrup'].includes(item?.type || '');

      useEffect(() => {
        if (item) {
          setDoseType(item.type || 'Tablet');
          setDoseQty('1.0');
          setDoseFreq('3');
          setDoseDays('7');
          setServiceQty('1');
          setErrors({});
        }
      }, [item]);

      if (!item) return null;

      const price = typeof item.price === 'number' && !isNaN(item.price) && item.price >= 0 ? item.price : 0;

      const calculateTotal = () => {
        if (isMedicine) {
          const qtyResult = validateQuantity(doseQty);
          const daysResult = validateDays(doseDays);
          const freq = parseInt(doseFreq) || 0;
          if (!qtyResult.valid || !daysResult.valid) return 0;
          return (qtyResult.value || 0) * freq * (daysResult.value || 0) * price;
        }
        const serviceResult = validateServiceQty(serviceQty);
        if (!serviceResult.valid) return 0;
        return (serviceResult.value || 1) * price;
      };

      const getTotalQty = () => {
        if (isMedicine) {
          const qtyResult = validateQuantity(doseQty);
          const daysResult = validateDays(doseDays);
          const freq = parseInt(doseFreq) || 0;
          if (!qtyResult.valid || !daysResult.valid) return 0;
          return (qtyResult.value || 0) * freq * (daysResult.value || 0);
        }
        const serviceResult = validateServiceQty(serviceQty);
        return serviceResult.valid ? (serviceResult.value || 1) : 0;
      };

      const handleAdd = () => {
        const newErrors = {};
        if (isMedicine) {
          const qtyResult = validateQuantity(doseQty);
          const daysResult = validateDays(doseDays);
          if (!qtyResult.valid) newErrors.doseQty = qtyResult.error || 'Invalid';
          if (!daysResult.valid) newErrors.doseDays = daysResult.error || 'Invalid';
        } else {
          const serviceResult = validateServiceQty(serviceQty);
          if (!serviceResult.valid) newErrors.serviceQty = serviceResult.error || 'Invalid';
        }
        if (Object.keys(newErrors).length > 0) {
          setErrors(newErrors);
          toast.error('Please fix validation errors');
          return;
        }
        const subtotal = calculateTotal();
        const totalQty = getTotalQty();
        if (subtotal <= 0 || totalQty <= 0) {
          toast.error('Invalid calculation - please check values');
          return;
        }
        onAddToBill({ ...item, category }, totalQty, subtotal);
        toast.success('Added to statement');
        onClose();
      };

      return React.createElement('div', { className: 'bg-card border border-border rounded-3xl p-6 mb-6 shadow-md animate-scale-in' },
        React.createElement('div', { className: 'flex justify-between items-center mb-6 pb-4 border-b border-border' },
          React.createElement('h4', { className: 'font-extrabold text-lg text-foreground flex items-center gap-2' },
            React.createElement(FlaskConical, { className: 'w-5 h-5 text-primary' }),
            'COMMIT: ',
            React.createElement('span', { className: 'text-primary' }, item.name)
          ),
          React.createElement(X, { className: 'w-6 h-6 text-muted-foreground cursor-pointer hover:text-foreground transition-colors', onClick: onClose })
        ),
        isMedicine ? React.createElement('div', { className: 'grid grid-cols-2 gap-4 mb-6' },
          React.createElement('div', { className: 'flex flex-col gap-2' },
            React.createElement('label', { className: 'text-xs font-extrabold text-muted-foreground uppercase tracking-wider' }, 'Dose Qty'),
            React.createElement('input', {
              type: 'text', value: doseQty,
              onChange: (e) => { setDoseQty(e.target.value); setErrors(prev => ({ ...prev, doseQty: '' })); },
              className: `bg-input border ${errors.doseQty ? 'border-destructive' : 'border-border'} text-foreground px-4 py-3 rounded-lg w-full outline-none font-semibold text-sm transition-all focus:border-primary focus:bg-surface-light focus:ring-2 focus:ring-primary/20`,
              placeholder: '1.0'
            }),
            errors.doseQty && React.createElement('span', { className: 'text-xs text-destructive' }, errors.doseQty)
          ),
          React.createElement('div', { className: 'flex flex-col gap-2' },
            React.createElement('label', { className: 'text-xs font-extrabold text-muted-foreground uppercase tracking-wider' }, 'Route'),
            React.createElement('select', {
              value: doseType, onChange: (e) => setDoseType(e.target.value),
              className: 'bg-input border border-border text-foreground px-4 py-3 rounded-lg w-full outline-none font-semibold text-sm transition-all focus:border-primary focus:bg-surface-light'
            },
              React.createElement('option', { value: 'Tablet' }, 'Tablet'),
              React.createElement('option', { value: 'Capsule' }, 'Capsule'),
              React.createElement('option', { value: 'Injection' }, 'Injection'),
              React.createElement('option', { value: 'Syrup' }, 'Syrup')
            )
          ),
          React.createElement('div', { className: 'flex flex-col gap-2' },
            React.createElement('label', { className: 'text-xs font-extrabold text-muted-foreground uppercase tracking-wider' }, 'Frequency'),
            React.createElement('select', {
              value: doseFreq, onChange: (e) => setDoseFreq(e.target.value),
              className: 'bg-input border border-border text-foreground px-4 py-3 rounded-lg w-full outline-none font-semibold text-sm transition-all focus:border-primary focus:bg-surface-light'
            },
              React.createElement('option', { value: '1' }, 'QD (1/day)'),
              React.createElement('option', { value: '2' }, 'BID (2/day)'),
              React.createElement('option', { value: '3' }, 'TID (3/day)'),
              React.createElement('option', { value: '4' }, 'QID (4/day)')
            )
          ),
          React.createElement('div', { className: 'flex flex-col gap-2' },
            React.createElement('label', { className: 'text-xs font-extrabold text-muted-foreground uppercase tracking-wider' }, 'Days'),
            React.createElement('input', {
              type: 'number', value: doseDays, min: '1', max: '365',
              onChange: (e) => { setDoseDays(e.target.value); setErrors(prev => ({ ...prev, doseDays: '' })); },
              className: `bg-input border ${errors.doseDays ? 'border-destructive' : 'border-border'} text-foreground px-4 py-3 rounded-lg w-full outline-none font-semibold text-sm transition-all focus:border-primary focus:bg-surface-light focus:ring-2 focus:ring-primary/20`
            }),
            errors.doseDays && React.createElement('span', { className: 'text-xs text-destructive' }, errors.doseDays)
          )
        ) : React.createElement('div', { className: 'grid grid-cols-2 gap-4 mb-6' },
          React.createElement('div', { className: 'flex flex-col gap-2' },
            React.createElement('label', { className: 'text-xs font-extrabold text-muted-foreground uppercase tracking-wider' }, 'Units Required'),
            React.createElement('input', {
              type: 'number', value: serviceQty, min: '1', max: '100',
              onChange: (e) => { setServiceQty(e.target.value); setErrors(prev => ({ ...prev, serviceQty: '' })); },
              className: `bg-input border ${errors.serviceQty ? 'border-destructive' : 'border-border'} text-foreground px-4 py-3 rounded-lg w-full outline-none font-semibold text-sm transition-all focus:border-primary focus:bg-surface-light focus:ring-2 focus:ring-primary/20`
            }),
            errors.serviceQty && React.createElement('span', { className: 'text-xs text-destructive' }, errors.serviceQty)
          )
        ),
        React.createElement('div', { className: 'flex items-center justify-between pt-6 border-t border-border' },
          React.createElement('div', { className: 'font-mono font-bold text-3xl text-primary' },
            `à§³ ${calculateTotal().toLocaleString('en-IN', { minimumFractionDigits: 2 })}`
          ),
          React.createElement('button', {
            onClick: handleAdd,
            className: 'bg-primary text-primary-foreground font-extrabold rounded-xl px-6 py-3 text-sm flex items-center gap-2 transition-all duration-200 hover:bg-primary/90 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-primary/30 uppercase tracking-wide'
          },
            React.createElement(PlusCircle, { className: 'w-5 h-5' }),
            'ADD TO STATEMENT'
          )
        )
      );
    };

    // MedicineTags Component
    const MedicineTags = ({ bill, onRemove }) => {
      const meds = bill.filter(item => item.category === 'Medicine' || item.category === 'Discharge Medicine');
      if (meds.length === 0) return null;

      return React.createElement('div', { className: 'bg-surface-light border border-border rounded-2xl p-4 min-h-14 flex flex-wrap gap-2 mb-6 items-center shadow-md animate-fade-in' },
        React.createElement('div', { className: 'flex items-center gap-2 text-xs font-extrabold text-muted-foreground uppercase tracking-wider' },
          React.createElement(Pill, { className: 'w-4 h-4 text-primary' }),
          'ACTIVE MEDS:'
        ),
        React.createElement('div', { className: 'flex flex-wrap gap-2 ml-3' },
          meds.map((med, idx) => React.createElement('span', {
            key: `${med.name}-${idx}`,
            className: 'bg-input border border-primary rounded-lg px-3 py-1.5 text-xs font-bold text-primary flex items-center gap-2 shadow-sm'
          },
            med.name,
            React.createElement(X, { className: 'w-3 h-3 cursor-pointer text-muted-foreground hover:text-accent-red transition-colors', onClick: () => onRemove(med.name) })
          ))
        )
      );
    };

    // StatementSidebar Component
    const StatementSidebar = ({ title, prefix }) => {
      const { bill, removeFromBill, clearBill } = useBilling();
      const total = bill.reduce((sum, item) => sum + item.subtotal, 0);
      const categories = [...new Set(bill.map(item => item.category))].sort();

      const handleFinalize = () => {
        if (bill.length === 0) {
          toast.error('Statement is empty');
          return;
        }
        if (confirm(`Commit statement? Total: à§³ ${total.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`)) {
          clearBill();
          toast.success('Committed to server');
        }
      };

      return React.createElement('aside', { className: 'bg-card border border-border rounded-2xl p-6 lg:sticky lg:top-24 lg:h-[calc(100vh-120px)] flex flex-col shadow-md' },
        React.createElement('div', { className: 'flex justify-between items-center mb-6' },
          React.createElement('h3', { className: 'text-sm font-black uppercase tracking-wide text-foreground' }, title),
          React.createElement('button', {
            onClick: clearBill,
            className: 'text-muted-foreground text-xs font-black tracking-wider cursor-pointer transition-all border border-border px-3 py-1 rounded-md hover:text-primary-foreground hover:bg-accent-red hover:border-accent-red'
          }, 'RESET')
        ),
        React.createElement('div', { className: 'bg-input border border-border rounded-xl p-4 mb-6 border-l-4 border-l-primary' },
          React.createElement('div', { className: 'grid grid-cols-2 gap-3' },
            React.createElement('div', { className: 'flex flex-col gap-0.5' },
              React.createElement('span', { className: 'text-[10px] text-muted-foreground font-extrabold uppercase tracking-wide' }, 'Patient'),
              React.createElement('span', { className: 'text-xs text-foreground font-extrabold' }, `#${prefix.toUpperCase()}-2025`)
            ),
            React.createElement('div', { className: 'flex flex-col gap-0.5' },
              React.createElement('span', { className: 'text-[10px] text-muted-foreground font-extrabold uppercase tracking-wide' }, 'Location'),
              React.createElement('span', { className: 'text-xs text-foreground font-extrabold' }, prefix === 'op' ? 'BLOCK B' : 'WARD A')
            )
          )
        ),
        React.createElement('div', { className: 'flex-1 overflow-y-auto pr-1' },
          bill.length === 0 
            ? React.createElement('div', { className: 'text-center py-12 text-muted-foreground opacity-60 font-semibold text-sm' }, 'STATEMENT EMPTY')
            : categories.map(cat => {
                const items = bill.filter(item => item.category === cat);
                return React.createElement('div', { key: cat, className: 'mb-4' },
                  React.createElement('div', { className: 'text-xs font-extrabold text-primary mb-2' }, cat),
                  items.map((item, idx) => {
                    const billIndex = bill.indexOf(item);
                    return React.createElement('div', {
                      key: `${item.name}-${idx}`,
                      className: 'flex justify-between items-center py-1.5 text-sm gap-3'
                    },
                      React.createElement('span', { className: 'flex-1 font-bold text-foreground truncate' },
                        item.name,
                        React.createElement('span', { className: 'text-xs opacity-50 font-normal ml-1' }, `x${item.qty}`)
                      ),
                      React.createElement('span', { className: 'font-mono font-bold text-primary' },
                        `à§³ ${item.subtotal.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`
                      ),
                      React.createElement(X, {
                        className: 'w-4 h-4 text-muted-foreground cursor-pointer hover:text-accent-red transition-colors',
                        onClick: () => removeFromBill(billIndex)
                      })
                    );
                  })
                );
              })
        ),
        React.createElement('div', { className: 'border-t border-border pt-6' },
          React.createElement('div', { className: 'flex justify-between items-center mb-6' },
            React.createElement('span', { className: 'font-extrabold text-lg uppercase text-foreground' }, 'TOTAL'),
            React.createElement('span', { className: 'font-mono font-bold text-2xl text-primary' },
              `à§³ ${total.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`
            )
          ),
          React.createElement('button', {
            onClick: handleFinalize,
            className: 'w-full bg-primary text-primary-foreground font-black rounded-xl py-4 text-sm transition-all duration-200 hover:bg-primary/90 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-primary/30 uppercase tracking-wide flex items-center justify-center gap-2'
          },
            React.createElement(CheckCircle2, { className: 'w-5 h-5' }),
            'COMMIT'
          )
        )
      );
    };

    // ============= VIEWS =============

    // HomeView
    const HomeView = () => {
      const { setCurrentView } = useBilling();
      const { settings } = useSettings();

      const handleButtonClick = (view) => {
        if (navigator.vibrate) navigator.vibrate(15);
        setCurrentView(view);
      };

      return React.createElement('div', { className: 'flex flex-col items-center justify-center py-8 sm:py-16 px-4 animate-fade-in' },
        React.createElement('div', { className: 'mb-6 sm:mb-8 inline-block p-6 sm:p-8 rounded-3xl bg-primary/10 border-2 border-dashed border-primary shadow-primary-glow' },
          React.createElement(ShieldCheck, { className: 'w-16 h-16 sm:w-20 sm:h-20 text-primary' })
        ),
        React.createElement('h2', { className: 'text-2xl sm:text-4xl font-extrabold tracking-tight text-foreground mb-2 text-center' },
          settings.appName,
          React.createElement('span', { className: 'text-primary block sm:inline ml-2' }, `${settings.appSubtitle}.`)
        ),
        React.createElement('p', { className: 'text-base sm:text-lg text-muted-foreground max-w-md text-center font-semibold mb-8 sm:mb-10 px-4' },
          'Centralized Hospital Revenue Cycle Management Terminal.'
        ),
        React.createElement('div', { className: 'flex flex-col gap-3 w-full max-w-sm px-4 sm:px-0' },
          React.createElement('button', {
            onClick: () => handleButtonClick('outpatient'),
            className: 'w-full bg-primary hover:bg-primary/90 text-primary-foreground font-extrabold rounded-xl px-6 py-4 text-sm uppercase tracking-wide transition-all duration-200 touch-feedback hover:shadow-lg hover:shadow-primary/30 flex items-center justify-center gap-3'
          },
            React.createElement(UserCheck, { className: 'w-5 h-5' }),
            'OUTPATIENT TERMINAL'
          ),
          React.createElement('button', {
            onClick: () => handleButtonClick('inpatient'),
            className: 'w-full bg-accent hover:bg-accent/90 text-accent-foreground font-extrabold rounded-xl px-6 py-4 text-sm uppercase tracking-wide transition-all duration-200 touch-feedback hover:shadow-lg hover:shadow-accent/30 flex items-center justify-center gap-3'
          },
            React.createElement(BedDouble, { className: 'w-5 h-5' }),
            'INPATIENT CARE'
          )
        ),
        React.createElement('p', { className: 'sm:hidden mt-8 text-xs text-muted-foreground/60 text-center' }, 'ðŸ’¡ Pull down to refresh â€¢ Swipe tabs to navigate')
      );
    };

    // OutpatientView
    const OutpatientView = () => {
      const { inventory, outpatientCategories, currentCatOPIdx, setCurrentCatOPIdx, bill, addToBill, removeFromBill } = useBilling();
      const [viewMode, setViewMode] = useState('grid');
      const [searchQuery, setSearchQuery] = useState('');
      const [selectedItem, setSelectedItem] = useState(null);

      const currentCategory = outpatientCategories[currentCatOPIdx] || '';
      const items = (inventory[currentCategory] || []).filter(item =>
        item.name.toLowerCase().includes(searchQuery.toLowerCase())
      );

      const handleCategorySelect = (idx) => {
        setCurrentCatOPIdx(idx);
        setViewMode('carousel');
        setSelectedItem(null);
      };

      const handlePrev = () => setCurrentCatOPIdx((currentCatOPIdx - 1 + outpatientCategories.length) % outpatientCategories.length);
      const handleNext = () => setCurrentCatOPIdx((currentCatOPIdx + 1) % outpatientCategories.length);

      const handleAddToBill = (item, qty, subtotal) => {
        addToBill({ ...item, qty, subtotal });
      };

      const handleRemoveMedicine = (name) => {
        const idx = bill.findIndex(item => item.name === name);
        if (idx > -1) removeFromBill(idx);
      };

      const showMedicineTags = currentCategory === 'Medicine' || currentCategory === 'Discharge Medicine';

      return React.createElement('div', { className: 'animate-fade-in' },
        React.createElement('div', { className: 'mb-6' },
          React.createElement('h2', { className: 'text-2xl font-extrabold text-foreground' },
            'OUTPATIENT ',
            React.createElement('span', { className: 'font-light text-muted-foreground' }, 'TERMINAL')
          )
        ),
        // Desktop layout
        React.createElement('div', { className: 'hidden lg:grid lg:grid-cols-[1fr_380px] gap-8' },
          React.createElement('div', null,
            viewMode === 'grid'
              ? React.createElement('div', { className: 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 mb-6' },
                  outpatientCategories.map((cat, idx) =>
                    React.createElement(CategoryCard, {
                      key: cat, name: cat, count: inventory[cat]?.length || 0,
                      isActive: currentCatOPIdx === idx, onClick: () => handleCategorySelect(idx)
                    })
                  )
                )
              : React.createElement(CategoryCarousel, {
                  categoryName: currentCategory, itemCount: items.length,
                  onPrev: handlePrev, onNext: handleNext, onGridView: () => setViewMode('grid')
                }),
            selectedItem && React.createElement(DosagePanel, {
              item: selectedItem, category: currentCategory,
              onClose: () => setSelectedItem(null), onAddToBill: handleAddToBill
            }),
            showMedicineTags && viewMode === 'carousel' && React.createElement(MedicineTags, { bill, onRemove: handleRemoveMedicine }),
            viewMode === 'carousel' && React.createElement(React.Fragment, null,
              React.createElement('div', { className: 'bg-input border border-border rounded-2xl px-5 py-4 flex items-center gap-4 mb-6 transition-all focus-within:border-primary focus-within:ring-2 focus-within:ring-primary/20 focus-within:bg-card' },
                React.createElement(Search, { className: 'w-5 h-5 text-primary opacity-80' }),
                React.createElement('input', {
                  type: 'text', value: searchQuery, onChange: (e) => setSearchQuery(e.target.value),
                  placeholder: 'Search item codes...',
                  className: 'bg-transparent border-none text-foreground w-full outline-none text-base font-semibold placeholder:text-muted-foreground placeholder:font-medium'
                })
              ),
              React.createElement('div', { className: 'flex flex-col gap-3' },
                items.length === 0
                  ? React.createElement('div', { className: 'text-center py-12 text-muted-foreground opacity-60 font-semibold' }, 'NO MATCHES')
                  : items.map(item => React.createElement(ItemEntry, { key: item.id, item, onClick: () => setSelectedItem(item) }))
              )
            )
          ),
          React.createElement(StatementSidebar, { title: 'Statement', prefix: 'op' })
        ),
        // Mobile layout
        React.createElement('div', { className: 'lg:hidden' },
          viewMode === 'grid'
            ? React.createElement('div', { className: 'grid grid-cols-2 gap-3 mb-6' },
                outpatientCategories.map((cat, idx) =>
                  React.createElement(CategoryCard, {
                    key: cat, name: cat, count: inventory[cat]?.length || 0,
                    isActive: currentCatOPIdx === idx, onClick: () => handleCategorySelect(idx)
                  })
                )
              )
            : React.createElement(React.Fragment, null,
                React.createElement(CategoryCarousel, {
                  categoryName: currentCategory, itemCount: items.length,
                  onPrev: handlePrev, onNext: handleNext, onGridView: () => setViewMode('grid')
                }),
                selectedItem && React.createElement(DosagePanel, {
                  item: selectedItem, category: currentCategory,
                  onClose: () => setSelectedItem(null), onAddToBill: handleAddToBill
                }),
                showMedicineTags && React.createElement(MedicineTags, { bill, onRemove: handleRemoveMedicine }),
                React.createElement('div', { className: 'bg-input border border-border rounded-2xl px-5 py-4 flex items-center gap-4 mb-6 transition-all focus-within:border-primary focus-within:ring-2 focus-within:ring-primary/20 focus-within:bg-card' },
                  React.createElement(Search, { className: 'w-5 h-5 text-primary opacity-80' }),
                  React.createElement('input', {
                    type: 'text', value: searchQuery, onChange: (e) => setSearchQuery(e.target.value),
                    placeholder: 'Search item codes...',
                    className: 'bg-transparent border-none text-foreground w-full outline-none text-base font-semibold placeholder:text-muted-foreground placeholder:font-medium'
                  })
                ),
                React.createElement('div', { className: 'flex flex-col gap-3 mb-6' },
                  items.length === 0
                    ? React.createElement('div', { className: 'text-center py-12 text-muted-foreground opacity-60 font-semibold' }, 'NO MATCHES')
                    : items.map(item => React.createElement(ItemEntry, { key: item.id, item, onClick: () => setSelectedItem(item) }))
                )
              ),
          React.createElement(StatementSidebar, { title: 'Statement', prefix: 'op' })
        )
      );
    };

    // InpatientView
    const InpatientView = () => {
      const { inventory, inpatientCategories, currentCatIPIdx, setCurrentCatIPIdx, bill, addToBill, removeFromBill } = useBilling();
      const [viewMode, setViewMode] = useState('grid');
      const [searchQuery, setSearchQuery] = useState('');
      const [selectedItem, setSelectedItem] = useState(null);
      const [patientName, setPatientName] = useState('');

      const currentCategory = inpatientCategories[currentCatIPIdx] || '';
      const items = (inventory[currentCategory] || []).filter(item =>
        item.name.toLowerCase().includes(searchQuery.toLowerCase())
      );

      const handleCategorySelect = (idx) => {
        setCurrentCatIPIdx(idx);
        setViewMode('carousel');
        setSelectedItem(null);
      };

      const handlePrev = () => setCurrentCatIPIdx((currentCatIPIdx - 1 + inpatientCategories.length) % inpatientCategories.length);
      const handleNext = () => setCurrentCatIPIdx((currentCatIPIdx + 1) % inpatientCategories.length);

      const handleAddToBill = (item, qty, subtotal) => {
        addToBill({ ...item, qty, subtotal });
      };

      const handleRemoveMedicine = (name) => {
        const idx = bill.findIndex(item => item.name === name);
        if (idx > -1) removeFromBill(idx);
      };

      const showMedicineTags = currentCategory === 'Medicine' || currentCategory === 'Discharge Medicine';

      // Admission Card
      const AdmissionCard = React.createElement('div', { className: 'bg-card border border-border rounded-2xl p-5 mb-6 shadow-md' },
        React.createElement('h5', { className: 'text-xs font-black text-primary uppercase tracking-wide mb-3 flex items-center gap-2' },
          React.createElement(UserCircle, { className: 'w-4 h-4' }),
          'ADMISSION'
        ),
        React.createElement('input', {
          type: 'text', value: patientName, onChange: (e) => setPatientName(e.target.value),
          placeholder: 'Patient Name (Required)',
          className: 'bg-input border border-border text-foreground px-4 py-3 rounded-lg w-full outline-none font-semibold text-sm transition-all focus:border-primary focus:bg-surface-light focus:ring-2 focus:ring-primary/20 placeholder:text-muted-foreground'
        })
      );

      return React.createElement('div', { className: 'animate-fade-in' },
        React.createElement('div', { className: 'mb-6' },
          React.createElement('h2', { className: 'text-2xl font-extrabold text-foreground' },
            'INPATIENT ',
            React.createElement('span', { className: 'font-light text-muted-foreground' }, 'CARE')
          )
        ),
        // Desktop layout
        React.createElement('div', { className: 'hidden lg:grid lg:grid-cols-[1fr_380px] gap-8' },
          React.createElement('div', null,
            AdmissionCard,
            viewMode === 'grid'
              ? React.createElement('div', { className: 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 mb-6' },
                  inpatientCategories.map((cat, idx) =>
                    React.createElement(CategoryCard, {
                      key: cat, name: cat, count: inventory[cat]?.length || 0,
                      isActive: currentCatIPIdx === idx, onClick: () => handleCategorySelect(idx)
                    })
                  )
                )
              : React.createElement(CategoryCarousel, {
                  categoryName: currentCategory, itemCount: items.length,
                  onPrev: handlePrev, onNext: handleNext, onGridView: () => setViewMode('grid')
                }),
            selectedItem && React.createElement(DosagePanel, {
              item: selectedItem, category: currentCategory,
              onClose: () => setSelectedItem(null), onAddToBill: handleAddToBill
            }),
            showMedicineTags && viewMode === 'carousel' && React.createElement(MedicineTags, { bill, onRemove: handleRemoveMedicine }),
            viewMode === 'carousel' && React.createElement(React.Fragment, null,
              React.createElement('div', { className: 'bg-input border border-border rounded-2xl px-5 py-4 flex items-center gap-4 mb-6 transition-all focus-within:border-primary focus-within:ring-2 focus-within:ring-primary/20 focus-within:bg-card' },
                React.createElement(Search, { className: 'w-5 h-5 text-primary opacity-80' }),
                React.createElement('input', {
                  type: 'text', value: searchQuery, onChange: (e) => setSearchQuery(e.target.value),
                  placeholder: 'Search service codes...',
                  className: 'bg-transparent border-none text-foreground w-full outline-none text-base font-semibold placeholder:text-muted-foreground placeholder:font-medium'
                })
              ),
              React.createElement('div', { className: 'flex flex-col gap-3' },
                items.length === 0
                  ? React.createElement('div', { className: 'text-center py-12 text-muted-foreground opacity-60 font-semibold' }, 'NO MATCHES')
                  : items.map(item => React.createElement(ItemEntry, { key: item.id, item, onClick: () => setSelectedItem(item) }))
              )
            )
          ),
          React.createElement(StatementSidebar, { title: 'Record', prefix: 'ip' })
        ),
        // Mobile layout
        React.createElement('div', { className: 'lg:hidden' },
          AdmissionCard,
          viewMode === 'grid'
            ? React.createElement('div', { className: 'grid grid-cols-2 gap-3 mb-6' },
                inpatientCategories.map((cat, idx) =>
                  React.createElement(CategoryCard, {
                    key: cat, name: cat, count: inventory[cat]?.length || 0,
                    isActive: currentCatIPIdx === idx, onClick: () => handleCategorySelect(idx)
                  })
                )
              )
            : React.createElement(React.Fragment, null,
                React.createElement(CategoryCarousel, {
                  categoryName: currentCategory, itemCount: items.length,
                  onPrev: handlePrev, onNext: handleNext, onGridView: () => setViewMode('grid')
                }),
                selectedItem && React.createElement(DosagePanel, {
                  item: selectedItem, category: currentCategory,
                  onClose: () => setSelectedItem(null), onAddToBill: handleAddToBill
                }),
                showMedicineTags && React.createElement(MedicineTags, { bill, onRemove: handleRemoveMedicine }),
                React.createElement('div', { className: 'bg-input border border-border rounded-2xl px-5 py-4 flex items-center gap-4 mb-6 transition-all focus-within:border-primary focus-within:ring-2 focus-within:ring-primary/20 focus-within:bg-card' },
                  React.createElement(Search, { className: 'w-5 h-5 text-primary opacity-80' }),
                  React.createElement('input', {
                    type: 'text', value: searchQuery, onChange: (e) => setSearchQuery(e.target.value),
                    placeholder: 'Search service codes...',
                    className: 'bg-transparent border-none text-foreground w-full outline-none text-base font-semibold placeholder:text-muted-foreground placeholder:font-medium'
                  })
                ),
                React.createElement('div', { className: 'flex flex-col gap-3 mb-6' },
                  items.length === 0
                    ? React.createElement('div', { className: 'text-center py-12 text-muted-foreground opacity-60 font-semibold' }, 'NO MATCHES')
                    : items.map(item => React.createElement(ItemEntry, { key: item.id, item, onClick: () => setSelectedItem(item) }))
                )
              ),
          React.createElement(StatementSidebar, { title: 'Record', prefix: 'ip' })
        )
      );
    };

    // PricingView
    const PricingView = () => {
      const { inventory, outpatientCategories } = useBilling();
      const [selectedCategory, setSelectedCategory] = useState(outpatientCategories[0] || '');
      const [searchQuery, setSearchQuery] = useState('');

      const items = (inventory[selectedCategory] || []).filter(item =>
        item.name.toLowerCase().includes(searchQuery.toLowerCase())
      );

      return React.createElement('div', { className: 'animate-fade-in' },
        React.createElement('div', { className: 'mb-6' },
          React.createElement('h2', { className: 'text-2xl font-extrabold text-foreground' },
            'PRICE ',
            React.createElement('span', { className: 'font-light text-muted-foreground' }, 'LIST')
          )
        ),
        React.createElement('div', { className: 'flex flex-wrap gap-2 mb-6' },
          outpatientCategories.map(cat =>
            React.createElement('button', {
              key: cat,
              onClick: () => setSelectedCategory(cat),
              className: cn(
                'px-4 py-2 rounded-xl text-xs font-bold uppercase transition-all',
                selectedCategory === cat
                  ? 'bg-primary text-primary-foreground'
                  : 'bg-card border border-border text-muted-foreground hover:text-foreground'
              )
            }, cat)
          )
        ),
        React.createElement('div', { className: 'bg-input border border-border rounded-2xl px-5 py-4 flex items-center gap-4 mb-6 transition-all focus-within:border-primary focus-within:ring-2 focus-within:ring-primary/20 focus-within:bg-card' },
          React.createElement(Search, { className: 'w-5 h-5 text-primary opacity-80' }),
          React.createElement('input', {
            type: 'text', value: searchQuery, onChange: (e) => setSearchQuery(e.target.value),
            placeholder: 'Search items...',
            className: 'bg-transparent border-none text-foreground w-full outline-none text-base font-semibold placeholder:text-muted-foreground placeholder:font-medium'
          })
        ),
        React.createElement('div', { className: 'flex flex-col gap-3' },
          items.length === 0
            ? React.createElement('div', { className: 'text-center py-12 text-muted-foreground opacity-60 font-semibold' }, 'NO ITEMS')
            : items.map(item => React.createElement(ItemEntry, { key: item.id, item, onClick: () => {} }))
        )
      );
    };

    // PatientsView
    const PatientsView = () => {
      const [patients] = useState(MOCK_PATIENTS);
      const [showForm, setShowForm] = useState(false);

      return React.createElement('div', { className: 'animate-fade-in' },
        React.createElement('div', { className: 'flex justify-between items-center mb-6' },
          React.createElement('h2', { className: 'text-2xl font-extrabold text-foreground' },
            'PATIENTS ',
            React.createElement('span', { className: 'font-light text-muted-foreground' }, 'REGISTRY')
          ),
          React.createElement('button', {
            onClick: () => setShowForm(!showForm),
            className: 'bg-primary text-primary-foreground font-bold px-4 py-2 rounded-xl text-sm flex items-center gap-2'
          },
            React.createElement(PlusCircle, { className: 'w-4 h-4' }),
            'ADD PATIENT'
          )
        ),
        showForm && React.createElement('div', { className: 'bg-card border border-border rounded-2xl p-6 mb-6 shadow-md' },
          React.createElement('h3', { className: 'text-sm font-black text-primary uppercase mb-4' }, 'New Patient'),
          React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-4' },
            React.createElement('input', { type: 'text', placeholder: 'Name', className: 'bg-input border border-border text-foreground px-4 py-3 rounded-lg w-full outline-none font-semibold text-sm' }),
            React.createElement('input', { type: 'number', placeholder: 'Age', className: 'bg-input border border-border text-foreground px-4 py-3 rounded-lg w-full outline-none font-semibold text-sm' }),
            React.createElement('input', { type: 'text', placeholder: 'Phone', className: 'bg-input border border-border text-foreground px-4 py-3 rounded-lg w-full outline-none font-semibold text-sm' })
          ),
          React.createElement('button', {
            onClick: () => { toast.success('Patient saved!'); setShowForm(false); },
            className: 'mt-4 bg-primary text-primary-foreground font-bold px-6 py-3 rounded-xl text-sm'
          }, 'SAVE PATIENT')
        ),
        React.createElement('div', { className: 'flex flex-col gap-3' },
          patients.map(patient =>
            React.createElement('div', {
              key: patient.id,
              className: 'bg-card border border-border rounded-2xl px-5 py-4 flex justify-between items-center shadow-md'
            },
              React.createElement('div', { className: 'flex items-center gap-4' },
                React.createElement('div', { className: 'w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center' },
                  React.createElement(User, { className: 'w-5 h-5 text-primary' })
                ),
                React.createElement('div', null,
                  React.createElement('span', { className: 'font-bold text-foreground block' }, patient.name),
                  React.createElement('span', { className: 'text-xs text-muted-foreground' }, `Age: ${patient.age} â€¢ ${patient.phone}`)
                )
              ),
              React.createElement('span', { className: 'font-mono text-sm text-muted-foreground' }, `#${patient.id}`)
            )
          )
        )
      );
    };

    // Main Content Component
    const MainContent = () => {
      const { currentView } = useBilling();

      const renderView = () => {
        switch (currentView) {
          case 'home': return React.createElement(HomeView);
          case 'outpatient': return React.createElement(OutpatientView);
          case 'inpatient': return React.createElement(InpatientView);
          case 'pricing': return React.createElement(PricingView);
          case 'patients': return React.createElement(PatientsView);
          default: return React.createElement(HomeView);
        }
      };

      return React.createElement('main', { className: 'max-w-7xl mx-auto px-3 sm:px-4 pb-8' },
        renderView()
      );
    };

    // Index Page
    const IndexPage = () => {
      return React.createElement(BillingProvider, null,
        React.createElement(Header),
        React.createElement(Navigation),
        React.createElement(MainContent)
      );
    };

    // App Component
    const App = () => {
      return React.createElement(HashRouter, null,
        React.createElement(AuthProvider, null,
          React.createElement(SettingsProvider, null,
            React.createElement(Routes, null,
              React.createElement(Route, { path: '/', element: React.createElement(IndexPage) }),
              React.createElement(Route, { path: '*', element: React.createElement(IndexPage) })
            )
          )
        )
      );
    };

    // Mount
    const root = createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>
